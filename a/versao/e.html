<code><span style="color: #000000">
&lt;?<br />&nbsp;&nbsp;&nbsp;&nbsp;require("../scripts/conn.php");&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;isset($id_usuario)&nbsp;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ok&nbsp;=&nbsp;verificasenha($cookieEmailUsuario,&nbsp;$cookieSenhamd5&nbsp;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($ok&lt;&gt;$id_usuario)&nbsp;{&nbsp;header("Location:&nbsp;index.php");&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nomeusuario=peganomeusuario($ok);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setcookie("loginok");&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header("Location:&nbsp;index.php");<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;"select&nbsp;id&nbsp;from&nbsp;i_conjunto&nbsp;where&nbsp;not&nbsp;ok";<br />&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;mysql_query($sql);<br />&nbsp;&nbsp;&nbsp;&nbsp;$linha=mysql_fetch_object($result);<br />&nbsp;&nbsp;&nbsp;&nbsp;$tem&nbsp;=&nbsp;mysql_affected_rows();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($tem&nbsp;&gt;&nbsp;0)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;$data_atual&nbsp;=&nbsp;date("d&nbsp;m&nbsp;Y");<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;$m[1]="";<br />&nbsp;&nbsp;&nbsp;&nbsp;$m[2]="";&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($NOT)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$andamento&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$m[1]&nbsp;=&nbsp;"index.php";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$m[2]&nbsp;=&nbsp;"terminados";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$m[3]&nbsp;=&nbsp;"em&nbsp;andamento";<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$andamento&nbsp;=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$m[1]&nbsp;=&nbsp;"index.php?NOT=NOT";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$m[2]&nbsp;=&nbsp;"em&nbsp;andamento";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$m[3]&nbsp;=&nbsp;"terminados";<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;listaTarefas($id_conjunto,&nbsp;$id_usuario,&nbsp;$andamento)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;$data_release;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okconjunto&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$saida&nbsp;=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["sublinha"]&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Primeiro&nbsp;listo&nbsp;as&nbsp;tarefas&nbsp;do&nbsp;usuario<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;"select&nbsp;id_tarefa&nbsp;from&nbsp;i_tarefapessoa&nbsp;WHERE&nbsp;id_usuario&nbsp;=&nbsp;$id_usuario;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;mysql_query($sql);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tarefausuario&nbsp;=&nbsp;"...";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;$linha=mysql_fetch_object($result)&nbsp;)&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tarefausuario&nbsp;.=&nbsp;"+$linha-&gt;id_tarefa";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql1&nbsp;=&nbsp;"SELECT&nbsp;*&nbsp;from&nbsp;i_tarefas&nbsp;WHERE&nbsp;tabela&nbsp;&lt;&gt;&nbsp;''&nbsp;ORDER&nbsp;BY&nbsp;ordem;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result1&nbsp;=&nbsp;mysql_query($sql1);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$conta=0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(&nbsp;$linha1&nbsp;=&nbsp;mysql_fetch_object($result1)&nbsp;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />$Usuarios&nbsp;=&nbsp;"select&nbsp;usuario.nome,&nbsp;usuario.email,&nbsp;usuario.login,&nbsp;usuario.id_usuario&nbsp;from&nbsp;usuario&nbsp;inner&nbsp;join&nbsp;i_tarefapessoa&nbsp;on&nbsp;usuario.id_usuario&nbsp;=&nbsp;i_tarefapessoa.id_usuario&nbsp;where&nbsp;i_tarefapessoa.id_tarefa&nbsp;=&nbsp;$linha1-&gt;id&nbsp;order&nbsp;by&nbsp;nome";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$uResult&nbsp;=&nbsp;mysql_query($Usuarios);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$u&nbsp;=&nbsp;"";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;($usuario=mysql_fetch_object($uResult))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$u&nbsp;.=&nbsp;"$usuario-&gt;nome&nbsp;ou&nbsp;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$u&nbsp;=&nbsp;substr($u,&nbsp;0,&nbsp;strlen($u)-4)&nbsp;.&nbsp;".";<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tarefa=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tarefaAux&nbsp;=&nbsp;"+"&nbsp;.&nbsp;$linha1-&gt;id;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strpos(&nbsp;$tarefausuario,&nbsp;$tarefaAux)&nbsp;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tarefa&nbsp;=&nbsp;1;&nbsp;&nbsp;//&nbsp;Essa&nbsp;tarefa&nbsp;é&nbsp;desse&nbsp;usuario;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;SQL&nbsp;:&nbsp;um&nbsp;pra&nbsp;cada&nbsp;tabela,&nbsp;le&nbsp;o&nbsp;arquivo&nbsp;tabela.sql<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;require(&nbsp;"$linha1-&gt;tabela.sql");<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;"SELECT&nbsp;*&nbsp;from&nbsp;$linha1-&gt;tabela&nbsp;where&nbsp;id_conjunto&nbsp;=&nbsp;$id_conjunto;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Echo($sql);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;mysql_query($sql)&nbsp;or&nbsp;die($sql);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$linha&nbsp;=&nbsp;mysql_fetch_object($result);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["area"]&nbsp;=&nbsp;$linha1-&gt;area;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["descricao"]&nbsp;=&nbsp;$linha1-&gt;descricao;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["tarefa"]&nbsp;=&nbsp;$linha1-&gt;nome;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["tabela"]&nbsp;=&nbsp;$linha1-&gt;tabela;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["t"]&nbsp;=&nbsp;$linha1-&gt;nome;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["usuarios"]&nbsp;=&nbsp;$u;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;pego&nbsp;o&nbsp;OK&nbsp;de&nbsp;todas&nbsp;as&nbsp;tabelas,&nbsp;menos&nbsp;a&nbsp;i_download;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;$linha1-&gt;tabela&nbsp;!=&nbsp;'i_administracao'&nbsp;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$oktarefa&nbsp;=&nbsp;!$linha-&gt;ok;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okconjunto&nbsp;=&nbsp;$okconjunto&nbsp;+&nbsp;$oktarefa&nbsp;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($tarefa)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;!$linha-&gt;ok&nbsp;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["tarefa"]&nbsp;=&nbsp;"&lt;b&gt;".&nbsp;$tmp["tarefa"]&nbsp;."&lt;/b&gt;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["tarefa"]&nbsp;=&nbsp;$tmp["tarefa"];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["atencao"]&nbsp;=&nbsp;"NA";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($linha-&gt;existe)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["atencao"]&nbsp;=&nbsp;"&lt;a&nbsp;href=\"javascript:alterna($linha1-&gt;tabela$id_conjunto,&nbsp;txt$linha1-&gt;tabela$id_conjunto,&nbsp;'+',&nbsp;'-');\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span&nbsp;id=txt$linha1-&gt;tabela$id_conjunto&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/a&gt;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$quem&nbsp;=&nbsp;peganomeusuario($linha-&gt;id_usuario);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if($linha-&gt;ok)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["ok"]&nbsp;=&nbsp;"&lt;font&nbsp;color=#006600&gt;&lt;b&gt;OK&lt;/b&gt;&lt;/font&gt;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["atencao"]&nbsp;=&nbsp;"&lt;font&nbsp;color=#006600&gt;&lt;b&gt;OK&lt;/b&gt;&lt;/font&gt;";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["ok"]&nbsp;=&nbsp;"&lt;font&nbsp;color=#ff0000&gt;FALTA&lt;/font&gt;";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["atencao"]&nbsp;=&nbsp;"&lt;font&nbsp;color=#ff0000&gt;FALTA&lt;/font&gt;";&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$tmp["tarefa"]&nbsp;=&nbsp;"&lt;b&gt;".&nbsp;$tmp["tarefa"]&nbsp;."&lt;/b&gt;";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$tmp["color"]&nbsp;=&nbsp;"#DDFFEE";<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!$linha-&gt;ok)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$saida[$conta++]&nbsp;=&nbsp;$tmp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$saida;<br />}&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;$txtSQL&nbsp;=&nbsp;"SELECT&nbsp;id,&nbsp;sistema.sistema,&nbsp;versao,&nbsp;plataforma,&nbsp;data,&nbsp;hora,&nbsp;descricao,&nbsp;data_prev_liberacao&nbsp;FROM&nbsp;i_conjunto,&nbsp;sistema&nbsp;WHERE&nbsp;(sistema.id_sistema&nbsp;=&nbsp;i_conjunto.id_sistema)&nbsp;AND&nbsp;$NOT&nbsp;!ok&nbsp;ORDER&nbsp;BY&nbsp;data&nbsp;DESC,&nbsp;hora&nbsp;DESC;";<br />&nbsp;&nbsp;$result&nbsp;=&nbsp;mysql_query($txtSQL);&nbsp;&nbsp;<br />&nbsp;&nbsp;$count&nbsp;=&nbsp;mysql_affected_rows();<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;$headers&nbsp;&nbsp;=&nbsp;"MIME-Version:&nbsp;1.0\n";<br />&nbsp;&nbsp;$headers&nbsp;.=&nbsp;"Content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1\n";<br />&nbsp;&nbsp;$headers&nbsp;.=&nbsp;"From:&nbsp;Intranet&nbsp;Datamace&lt;agenda@datamace.com.br&gt;\n";<br /><br />&nbsp;&nbsp;$subject&nbsp;=&nbsp;"Releases";<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;$emailpadrao&nbsp;=&nbsp;"fernando.nomellini@datamace.com.br";<br />&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;$textEmail&nbsp;="";<br />&nbsp;&nbsp;$textEmail&nbsp;.=&nbsp;"&nbsp;&nbsp;<br />&lt;style&nbsp;type=\"text/css\"&gt;<br />&lt;!--<br />body&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;font-family:&nbsp;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;<br />&nbsp;&nbsp;&nbsp;&nbsp;font-size:&nbsp;9px;<br />}<br />td&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;font-family:&nbsp;Verdana,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;<br />&nbsp;&nbsp;&nbsp;&nbsp;font-size:&nbsp;10px;<br />}<br />.style1&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;color:&nbsp;#FFFFFF;<br />&nbsp;&nbsp;&nbsp;&nbsp;font-weight:&nbsp;bold;<br />}<br />.style2&nbsp;{color:&nbsp;#FFFFFF}<br />.style9&nbsp;{color:&nbsp;#333333;&nbsp;font-weight:&nbsp;bold;&nbsp;}<br />.style11&nbsp;{color:&nbsp;#00FFFF}<br />--&gt;<br />&lt;/style&gt;<br /><br />&lt;table&nbsp;align=\"center\"&nbsp;width=\"99%\"&nbsp;border=\"0\"&nbsp;cellspacing=\"1\"&nbsp;cellpadding=\"1\"&nbsp;bgcolor=\"#CCCCCC\"&gt;<br />&nbsp;&nbsp;&lt;tr&nbsp;bgcolor=\"#333333\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;colspan=\"7\"&gt;&lt;span&nbsp;class=\"style2\"&gt;Releases&nbsp;em&nbsp;aberto&nbsp;com&nbsp;tarefas&nbsp;pendentes&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&lt;tr&nbsp;valign=\"middle\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"2%\"&nbsp;align=\"center\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style1\"&gt;+&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"18%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style2\"&gt;&lt;b&gt;sistema&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"5%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style2\"&gt;&lt;b&gt;vers&amp;atilde;o&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"9%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style2\"&gt;&lt;b&gt;plataforma&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"16%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style2\"&gt;&lt;b&gt;data/hora&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"36%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style2\"&gt;&lt;b&gt;Descri&amp;ccedil;&amp;atilde;o&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"14%\"&nbsp;align=\"right\"&nbsp;valign=\"middle\"&nbsp;bgcolor=\"#666666\"&gt;&lt;span&nbsp;class=\"style2\"&gt;&lt;b&gt;Data&nbsp;prevista&nbsp;libera&amp;ccedil;&amp;atilde;o&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;";<br />&nbsp;&nbsp;while&nbsp;&nbsp;(&nbsp;$linha&nbsp;=&nbsp;mysql_fetch_object($result))&nbsp;{<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$id_conjunto&nbsp;=&nbsp;$linha-&gt;id;<br />&nbsp;&nbsp;&nbsp;&nbsp;$data_release&nbsp;=&nbsp;$linha-&gt;data;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$d&nbsp;=&nbsp;explode("-",&nbsp;$linha-&gt;data);<br />&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;=&nbsp;"$d[2]/$d[1]/$d[0]";<br />&nbsp;&nbsp;&nbsp;&nbsp;$d&nbsp;=&nbsp;explode("-",&nbsp;substr(($linha-&gt;data_prev_liberacao),0,10));<br />&nbsp;&nbsp;&nbsp;&nbsp;$previsao&nbsp;=&nbsp;"$d[2]/$d[1]/$d[0]";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$bgColor&nbsp;=&nbsp;&nbsp;$tmp["color"];&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$data1&nbsp;=&nbsp;explode("-",&nbsp;$linha-&gt;data_prev_liberacao&nbsp;);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$dia&nbsp;=&nbsp;$data1[2];<br />&nbsp;&nbsp;&nbsp;&nbsp;$mes&nbsp;=&nbsp;$data1[1];<br />&nbsp;&nbsp;&nbsp;&nbsp;$ano&nbsp;=&nbsp;$data1[0];<br />&nbsp;&nbsp;&nbsp;&nbsp;$d_garan&nbsp;=&nbsp;strtotime("+7&nbsp;day",&nbsp;mktime(0,&nbsp;0,&nbsp;0,&nbsp;$mes,&nbsp;$dia,&nbsp;$ano));<br />&nbsp;&nbsp;&nbsp;&nbsp;$amanha&nbsp;=&nbsp;date("Y-m-d",$d_garan);&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$data2&nbsp;=&nbsp;explode("-",&nbsp;$amanha&nbsp;);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$dia&nbsp;=&nbsp;$data2[2];<br />&nbsp;&nbsp;&nbsp;&nbsp;$mes&nbsp;=&nbsp;$data2[1];<br />&nbsp;&nbsp;&nbsp;&nbsp;$ano&nbsp;=&nbsp;$data2[0];<br />&nbsp;&nbsp;&nbsp;&nbsp;$vencimento&nbsp;=&nbsp;mktime(0,&nbsp;0,&nbsp;0,&nbsp;$mes,&nbsp;$dia,&nbsp;$ano);<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$data3&nbsp;=&nbsp;date("Y-m-d");&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$data1&nbsp;=&nbsp;explode("-",&nbsp;$data3&nbsp;);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;$dia&nbsp;=&nbsp;$data1[2];<br />&nbsp;&nbsp;&nbsp;&nbsp;$mes&nbsp;=&nbsp;$data1[1];<br />&nbsp;&nbsp;&nbsp;&nbsp;$ano&nbsp;=&nbsp;$data1[0];<br />&nbsp;&nbsp;&nbsp;&nbsp;$hoje&nbsp;=&nbsp;mktime(0,&nbsp;0,&nbsp;0,&nbsp;$mes,&nbsp;$dia,&nbsp;$ano);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if(&nbsp;$vencimento&nbsp;&lt;=&nbsp;$hoje&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bgColor&nbsp;=&nbsp;"#FFD9DA";<br />&nbsp;&nbsp;&nbsp;&nbsp;else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$bgColor&nbsp;=&nbsp;"#CEEFFF";<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;$textEmail&nbsp;.=&nbsp;"<br />&nbsp;&nbsp;&lt;tr&nbsp;bgcolor=\"#CCCCCC\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"2%\"&nbsp;align=\"center\"&nbsp;valign=\"middle\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;&amp;nbsp;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"18%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;$linha-&gt;sistema<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"5%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;$linha-&gt;versao<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"9%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;$linha-&gt;plataforma<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"16%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;$data&nbsp;&nbsp;$linha-&gt;hora<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"36%\"&nbsp;align=\"left\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;$linha-&gt;descricao<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"14%\"&nbsp;align=\"right\"&nbsp;valign=\"middle\"&nbsp;bgcolor=\"$bgColor\"&gt;&lt;span&nbsp;class=\"style9\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;$previsao<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&lt;tr&nbsp;valign=\"top\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;bgcolor=\"#FFFFFF\"&nbsp;colspan=\"7\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;table&nbsp;width=\"92%\"&nbsp;border=\"0\"&nbsp;cellspacing=\"1\"&nbsp;cellpadding=\"1\"&nbsp;align=\"right\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&nbsp;bgcolor=\"#000000\"&gt;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"19%\"&gt;&lt;span&nbsp;class=style2&gt;&lt;b&gt;Tarefa&nbsp;&lt;/b&gt;&lt;/span&gt;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"32%\"&nbsp;&gt;&lt;span&nbsp;class=style2&gt;&lt;b&gt;Descri&amp;ccedil;&amp;atilde;o&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"49%\"&nbsp;&gt;&lt;span&nbsp;class=style2&gt;&lt;b&gt;Respons&amp;aacute;veis&nbsp;&lt;/b&gt;&lt;/span&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";<br /><br />&nbsp;&nbsp;$tarefas&nbsp;=&nbsp;listatarefas(&nbsp;$id_conjunto,&nbsp;$ok,&nbsp;$andamento);&nbsp;&nbsp;<br />&nbsp;&nbsp;while&nbsp;(&nbsp;list($tmp1,&nbsp;$tmp)&nbsp;=&nbsp;each($tarefas)&nbsp;)&nbsp;{<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;$textEmail&nbsp;.=&nbsp;"&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&nbsp;bgcolor=\"$bgColor\"&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"19%\"&gt;".$tmp["tarefa"]."&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"32%\"&gt;".$tmp["descricao"]."&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;width=\"49%\"&gt;".$tmp["usuarios"]."&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;$textEmail&nbsp;.=&nbsp;"&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;";<br />&nbsp;}<br />&nbsp;&nbsp;$textEmail&nbsp;.=&nbsp;"&nbsp;<br />&lt;/table&gt;<br />&lt;br&nbsp;/&gt;<br />&lt;table&nbsp;width=\"99%\"&nbsp;border=\"0\"&nbsp;align=\"center\"&gt;<br />&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;bgcolor=\"#CEEFFF\"&gt;Releases&nbsp;em&nbsp;dia&nbsp;com&nbsp;tarefas&nbsp;pendentes&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&nbsp;bgcolor=\"#FFD9DA\"&gt;Release&nbsp;em&nbsp;atraso&nbsp;com&nbsp;tarefas&nbsp;pendentes&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;<br />&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Aos&nbsp;reponsáveis&nbsp;pelas&nbsp;tarefas&nbsp;em&nbsp;aberto,&nbsp;favor&nbsp;analisar&nbsp;com&nbsp;brevidade&lt;/td&gt;<br />&nbsp;&nbsp;&lt;/tr&gt;<br />&lt;/table&gt;";<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;=&nbsp;"select&nbsp;distinct&nbsp;u.email&nbsp;email&nbsp;from&nbsp;";<br />&nbsp;&nbsp;&nbsp;&nbsp;$sql&nbsp;.=&nbsp;"usuario&nbsp;u&nbsp;inner&nbsp;join&nbsp;i_tarefapessoa&nbsp;tp&nbsp;on&nbsp;tp.id_usuario&nbsp;=&nbsp;u.id_usuario&nbsp;";<br />&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;mysql_query($sql);<br />&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;($linha&nbsp;=&nbsp;mysql_fetch_object($result))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$nomes&nbsp;.=&nbsp;$linha-&gt;email;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;mail($emailpadrao,&nbsp;$subject,&nbsp;$textEmail&nbsp;.&nbsp;$nomes,&nbsp;$headers);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;}<br />?&gt;<br /></span>
</code>